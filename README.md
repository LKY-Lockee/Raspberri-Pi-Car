# Raspberry-Pi-Car

这个项目是一个用于控制树莓派小车的C语言程序。它包括了LED灯、电机、超声波传感器、红外线检测器和路径跟踪传感器的控制。

## 文件结构

- `header.h`: C语言常用头文件
- `raspberrypi.h`: WiringPi头文件
- `car.c`: 主程序文件，包含了所有的功能函数和主循环。

## 主要功能

- LED灯控制：初始化、开启、关闭和设置颜色。
- 电机控制：初始化、前进、后退、左转、右转和停止。
- 超声波传感器：初始化和测距。
- 红外线检测器和路径跟踪传感器：在主循环中读取状态。

## 使用方法

1. 将代码下载到你的树莓派上。
2. 使用gcc编译器编译`car.c`文件。
3. 运行生成的可执行文件。

## 注意事项

- 你需要在树莓派上安装WiringPi库才能运行这个程序。
- 你需要根据你的硬件设备修改`car.c`中的引脚定义。
- 你可以通过定义或取消定义`SHOW_RUN_LOG`、`ENABLE_INFRARED_DETECTORS`和`ENABLE_ULTRASONIC`来开启或关闭日志、红外线检测器和超声波传感器。

## 主程序代码解释

> [!NOTE]
> 使用 [Github Copilot](https://github.com/features/copilot) 生成

主程序代码是用C语言编写的，用于控制一个小车的运动。小车可以前进、后退、左转、右转，还可以停止。小车的运动是通过控制左右两个轮子的速度来实现的。此外，小车还配备了LED灯、红外探测器和超声波测距器等设备。

在代码的开始部分，定义了一些宏和类型，这些宏和类型主要用于设置GPIO引脚的编号和定义一些常用的类型。然后，定义了一些函数原型，这些函数用于控制LED灯的状态、控制小车的运动、初始化超声波测距器等。

在`main`函数中，首先初始化了Wiring PI库，然后初始化了LED灯和电机，如果定义了`ENABLE_ULTRASONIC`宏，则还会初始化超声波测距器。接下来，进入了一个无限循环，这个循环是小车的主循环，小车的所有操作都在这个循环中进行。

在主循环中，首先读取了路径跟踪传感器和红外探测器的状态，然后根据这些状态来控制小车的运动。例如，如果左右两个路径跟踪传感器都检测到了线（即SL和SR都为HIGH），那么小车就会停止；如果左右两个红外探测器都没有检测到障碍物（即IDL和IDR都为LOW），那么小车就会后退然后左转；如果左边的红外探测器检测到了障碍物而右边的没有（即IDL为HIGH而IDR为LOW），那么小车就会左转；以此类推。

在控制小车运动的函数中，主要是通过控制电机的PWM信号来改变小车的速度和方向。例如，在`run_forward`函数中，将AIN1和BIN1设为HIGH，将AIN2和BIN2设为LOW，然后设置PWMA和PWMB的PWM值为速度，这样就可以使小车前进；在`run_left`函数中，将AIN1设为HIGH，AIN2设为LOW，PWMA的PWM值设为速度的三分之一，将BIN1设为HIGH，BIN2设为LOW，PWMB的PWM值设为速度的两倍，这样就可以使小车左转。

在超声波测距器的函数中，主要是通过发送超声波然后接收反射回来的超声波来测量距离。在`distanceMeasure`函数中，首先将USTRIG设为LOW，延时2微秒，然后将USTRIG设为HIGH，延时10微秒，然后将USTRIG设为LOW，这样就发送出了一个超声波；然后，等待USECHO从LOW变为HIGH，记录下这个时间，再等待USECHO从HIGH变为LOW，记录下这个时间，两个时间的差就是超声波往返的时间，根据这个时间就可以计算出距离。